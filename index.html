<div id="login-overlay" style="position:fixed; top:0; left:0; width:100%; height:100%; background:#f3f4f6; z-index:9999; display:flex; justify-content:center; align-items:center; flex-direction:column;">
    <div style="background:white; padding:40px; border-radius:12px; box-shadow:0 4px 20px rgba(0,0,0,0.1); text-align:center; max-width:400px; width:90%;">
        <div style="font-size:40px; color:#3b82f6; margin-bottom:10px;"><i class="fa-solid fa-tooth"></i></div>
        <h2 style="margin-bottom:10px; color:#1e293b;">DeCMo（デクモ）</h2>
        <p style="color:#64748b; margin-bottom:30px;">Dental Clinic's Module Soft</p>
        <button id="login-btn" style="background:#3b82f6; color:white; border:none; padding:12px 24px; border-radius:6px; font-weight:bold; cursor:pointer; font-size:16px; width:100%; display:flex; align-items:center; justify-content:center; gap:10px;">
            <i class="fa-brands fa-google"></i> Googleでログイン
        </button>
        <p id="login-error" style="color:red; font-size:12px; margin-top:15px; display:none;"></p>
    </div>
</div>

<div class="app-container"> ... </div>

<script type="module">
  // Firebase SDKのインポート
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
  import { getAuth, GoogleAuthProvider, signInWithPopup, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";

  // ★ Step 1で取得したFirebase構成オブジェクトをここに貼り付けてください
  const firebaseConfig = {
    apiKey: "AIzaSy...",
    authDomain: "decmo-auth.firebaseapp.com",
    projectId: "decmo-auth",
    storageBucket: "...",
    messagingSenderId: "...",
    appId: "..."
  };

  // Firebase初期化
  const app = initializeApp(firebaseConfig);
  const auth = getAuth(app);
  const provider = new GoogleAuthProvider();

  // ログインボタンの処理
  document.getElementById('login-btn').addEventListener('click', () => {
    signInWithPopup(auth, provider)
      .catch((error) => {
        document.getElementById('login-error').textContent = "ログインに失敗しました: " + error.message;
        document.getElementById('login-error').style.display = 'block';
      });
  });

  // 認証状態の監視
  onAuthStateChanged(auth, async (user) => {
    if (user) {
      // ログイン成功時
      document.getElementById('login-overlay').style.display = 'none';
      
      // ユーザー情報をUIに反映
      document.querySelector('.user-name').textContent = user.displayName;
      
      // トークンを取得してデータ取得処理を開始
      const token = await user.getIdToken();
      window.startApp(token); // script.js内の関数を呼び出す
      
    } else {
      // 未ログイン時
      document.getElementById('login-overlay').style.display = 'flex';
    }
  });
</script>
